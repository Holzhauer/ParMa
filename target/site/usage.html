<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2014-07-01 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>ParMa - ParMa</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
      <meta name="author" content="Sascha Holzhauer" />
    <meta name="Date-Creation-yyyymmdd" content="20140303" />
    <meta name="Date-Revision-yyyymmdd" content="20140701" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                                                <img src="./images/parma-logo.png" alt="$alt" />
                </div>
                          <div id="bannerRight">
                                                <img src="./images/cesr-logo.gif" alt="$alt" />
                </div>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                  <div class="xright">                    <a href="http://repast.sourceforge.net/" class="externalLink" title="Repast Simphony">Repast Simphony</a>
              
                    
                &nbsp;| <span id="publishDate">Last Published: 2014-07-01</span>
              &nbsp;| <span id="projectVersion">Version: 0.93</span>
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>ParMa</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="features.html" title="Features">Features</a>
            </li>
                  <li class="none">
            <strong>Usage</strong>
          </li>
                  <li class="none">
                          <a href="https://sourceforge.net/projects/parma/files" class="externalLink" title="Downloads">Downloads</a>
            </li>
                  <li class="none">
                          <a href="./javadoc/index.html" target="new" title="JavaDoc">JavaDoc</a>
            </li>
                  <li class="none">
                          <a href="https://sourceforge.net/p/parma/code" class="externalLink" title="Source code">Source code</a>
            </li>
                  <li class="none">
                          <a href="https://sourceforge.net/p/parma/tickets" class="externalLink" title="Tickets">Tickets</a>
            </li>
                  <li class="none">
                          <a href="https://sourceforge.net/p/parma/mailman" class="externalLink" title="Mailing lists">Mailing lists</a>
            </li>
          </ul>
                       <h5>Related Projects</h5>
                  <ul>
                  <li class="none">
                          <a href="http://uranus4abm.sourceforge.net" class="externalLink" target="new" title="URaNuS">URaNuS</a>
            </li>
                  <li class="none">
                          <a href="http://more4abm.sourceforge.net" class="externalLink" target="new" title="MoRe">MoRe</a>
            </li>
                  <li class="none">
                          <a href="http://sesamgim.sourceforge.net" class="externalLink" target="new" title="SesamGIM">SesamGIM</a>
            </li>
          </ul>
                       <h5>Internal</h5>
                  <ul>
                  <li class="none">
                          <a href="implementation.html" title="Implementation">Implementation</a>
            </li>
                  <li class="none">
                          <a href="todo.html" title="ToDo">ToDo</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section">
<h2>Usage <a name="Usage"></a></h2>
<ul>
<li><a href="#Using_this_Documentation">Using this Documentation</a></li>
<li><a href="#The_Concept">The Concept</a>
<ul>
<li><a href="#Resolving_Parameter_Values">Resolving Parameter Values</a></li></ul></li>
<li><a href="#Getting_ParMa_to_work">Getting ParMa to work</a>
<ul>
<li><a href="#Create_parameter_definitions">Create parameter definitions</a></li>
<li><a href="#Adding_parameters">Adding parameters</a></li>
<li><a href="#Model_Initialisation">Model Initialisation</a></li>
<li><a href="#Access_Parameter_Values">Access Parameter Values</a></li></ul></li>
<li><a href="#Parameter_Readers">Parameter Readers</a>
<ul>
<li><a href="#PmDbParameterReader">PmDbParameterReader</a></li>
<li><a href="#PmXmlParameterReader">PmXmlParameterReader</a></li>
<li><a href="#PmDdXmlParameterReader">PmDdXmlParameterReader</a></li>
<li><a href="#PmGuiParameterReader">PmGuiParameterReader</a></li>
<li><a href="#Copying_parameter_values">Copying parameter values</a></li></ul></li>
<li><a href="#Special_Applications">Special Applications</a>
<ul>
<li><a href="#Specific_andor_Multiple_Instances_of_PmParameterManager">Specific and/or Multiple Instances of PmParameterManager</a></li>
<li><a href="#Use_more_than_one_Database_Source">Use more than one Database Source</a></li></ul></li>
<li><a href="#Known_Problems">Known Problems</a>
<ul>
<li><a href="#Parallel_Computing">Parallel Computing</a></li></ul></li></ul>
<div class="section">
<h3>Using this Documentation<a name="Using_this_Documentation"></a></h3>
<p>First, read section <a href="#Getting_ParMa_to_work">Getting ParMa to work</a>. Then, read the hints to the specific parameter readers below.</p></div>
<div class="section">
<h3>The Concept<a name="The_Concept"></a></h3>
<p>The <a href="./javadoc/de/cesr/parma/core/PmParameterManager.html"><tt>PmParameterManager</tt></a> is the central unit of the ParameterFramework. <a href="./javadoc/de/cesr/parma/core/PmParameterDefinition.html"><tt>PmParameterDefinition</tt>s</a> are registered at the manager.</p>
<p>Its <tt>init()</tt> method is called to read in available parameter data. The way to accomplish that task is defined by <tt>PmParameterReader</tt>s that are registered at the <tt>PmParameterManager</tt> and have a <tt>initParameters()</tt> method that is called from the manager. If no parameter values are read in, the parameter manager resolves parameter values in a certain way:</p>
<div class="section">
<h4>Resolving Parameter Values<a name="Resolving_Parameter_Values"></a></h4>
<p>See the figure for various scenarios of parameter value resolution.</p><img src="./figures/ParMa_ParameterValueResolution.png" alt="Parameter Value Resolution" />
<p>NOTE: Generally, default parameters have precedence before default PMs: If in a PM a default parameter B is defined for a certain parameter A and parameter A is not assigned a value, ParMa resolves the value for parameter B even if parameter B is not assigned a value in both the current PM and its default PM (and even if the default PM defines a value for parameter A). Thus, ParMa might step back to the default value of parameter B even if the default PM has assigned a value for parameter A.</p></div></div>
<div class="section">
<h3><a name="Getting_ParMa_to_work">Getting ParMa to work</a></h3>
<div class="section">
<h4>Create parameter definitions<a name="Create_parameter_definitions"></a></h4>
<p>First, <tt>PmParameterDefinition</tt>s need to be created. For convenience, these parameter definitions are defined by an enumeration, as the following example shows:</p>
<div class="source">
<pre>public enum PmFrameworkPa implements PmParameterDefinition {
   
      /**
       *  Location of XML file that specifies database settings:
       */
      DB_SETTINGS_FILE(String.class, &quot;./DbSettings.xml&quot;);
     

      private Class&lt;?&gt;  type;
      private Object    defaultValue;

      PmFrameworkPa(Class&lt;?&gt; type) {
        this(type, null);
      }

      PmFrameworkPa(Class&lt;?&gt; type, Object defaultValue) {
        this.type = type;
        this.defaultValue = defaultValue;
      }

      public Class &lt; ? &gt; getType() {
        return type;
      }

      public Object getDefaultValue() {
        return defaultValue;
      }
    }
</pre></div></div>
<div class="section">
<h4>Adding parameters<a name="Adding_parameters"></a></h4>
<p>In order to add a parameter you just need to add an enum value. Also consider to add a respective column in the parameter table in case you use the <a href="./javadoc/de/cesr/parma/reader/PmDbParameterReader"><tt>PmDbParameterReader</tt></a> (see <a href="#PmDbParameterReader">here</a> for further instructions).</p></div>
<div class="section">
<h4>Model Initialisation<a name="Model_Initialisation"></a></h4>
<p>Consider the following steps during model initialisation to initialise ParMa properly:</p>
<ol style="list-style-type: decimal">
<li>One or more <tt>PmParameterReader</tt>s are registered at the parameter manager:
<div class="source">
<pre>PmParameterManager.registerReader(new PmXmlParameterReader());
</pre></div></li>
<li>Then, trigger the parameter manager to read in parameter values. Parameter readers are initialised in the order they were registered at the manager. 
<div class="source">
<pre>PmParameterManager.init();
</pre></div></li></ol></div>
<div class="section">
<h4>Access Parameter Values<a name="Access_Parameter_Values"></a></h4>
<p>Finally, You will access the parameter values like this:</p>
<div class="source">
<pre>int num_total = ((Integer)PmParameterManager.getParameter(BasicPa.NUM_AGENTS)).intValue();
</pre></div></div></div>
<div class="section">
<h3>Parameter Readers<a name="Parameter_Readers"></a></h3>
<div class="section">
<h4>PmDbParameterReader<a name="PmDbParameterReader"></a></h4>
<p>The <a href="./javadoc/de/cesr/parma/reader/PmDbParameterReader"><tt>PmDbParameterReader</tt></a> connects to a MySQL database using <a href="./javadoc/de/cesr/parma/definition/PmFrameworkPa.html#LOCATION"><tt>PmFrameworkPa.LOCATION</tt></a>, <a href="./javadoc/de/cesr/parma/definition/PmFrameworkPa.html#DBNAME"><tt>PmFrameworkPa.DBNAME</tt></a>, <a href="./javadoc/de/cesr/parma/definition/PmFrameworkPa.html#USER"><tt>PmFrameworkPa.USER</tt></a>, and <a href="./javadoc/de/cesr/parma/definition/PmFrameworkPa.html#PASSWORD"><tt>PmFrameworkPa.PASSWORD</tt></a> and fetches parameter values from a specific row (<tt>PmFrameworkPa.PARAM_SET_ID</tt>) of a certain table (<tt>PmFrameworkPa.TBLNAME_PARAMS</tt>). In doing so it reads all columns that follow the correct naming pattern ([package].[Classname]:[parameter name]), eg. <tt>de.cesr.sonomode.param.BasicPa:NUM_AGENTS</tt>. Make sure to assign the correct data type to the column that enables Java to assign the value to the parameter.</p>
<p>There are two ways to set values for the database parameters:</p>
<ol style="list-style-type: decimal">
<li><tt>PmDbXmlParameterReader</tt> reads the database settings from an XML-File. The XML-File may look like this:
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;settings&gt;
        &lt;db&gt;
                &lt;SQL_LOCATION&gt;mysql&lt;/SQL_LOCATION&gt;
                &lt;SQL_DBNAME&gt;project&lt;/SQL_DBNAME&gt;
                &lt;SQL_USER&gt;user&lt;/SQL_USER&gt;
                &lt;SQL_PASSWORD&gt;password&lt;/SQL_PASSWORD&gt;
                &lt;SQL_TBLNAME_PARAMS&gt;table_params_main&lt;/SQL_TBLNAME_PARAMS&gt;
        &lt;/db&gt;
&lt;/settings&gt;
</pre></div>
<p>The <tt>PmDbXmlParameterReader</tt> also should be registered at the <tt>PmParameterManager</tt> before the <tt>PmDbParameterReader</tt>, whereas <tt>SqlPa.DB_SETTINGS_FILE</tt> contains the XML-file's location:</p>
<div class="source">
<pre>PmParameterManager.registerReader(new PmDbXmlParameterReader(SqlPa.DB_SETTINGS_FILE));
</pre></div></li>
<li>Set the parameters via Java code before PmParameterManager.init() is called:
<div class="source">
<pre>PmParameterManager.setParameter(PmFrameworkPa.LOCATION, &quot;localhost&quot;);
PmParameterManager.setParameter(PmFrameworkPa.DBNAME, &quot;agentbm&quot;);
PmParameterManager.setParameter(PmFrameworkPa.USER, &quot;modeller&quot;);
PmParameterManager.setParameter(PmFrameworkPa.PASSWORD, &quot;password&quot;);
PmParameterManager.setParameter(PmFrameworkPa.TBLNAME_PARAMS, &quot;params&quot;);
</pre></div></li></ol>
<p>There are three ways to set the parameter-set ID:</p>
<ol style="list-style-type: decimal">
<li>The parameter definition that contains the parameter-set ID for which parameter definitions shall be fetched from DB may be passed by the constructor:
<div class="source">
<pre>PmParameterManager.registerReader(new PmDbParameterReader(BasicPa.PARAM_SET_ID));
</pre></div></li>
<li>The parameter-set ID needs to be assigned to <tt>PmFramworkPa#PARAM_SET_ID</tt>. Use the following syntax to pass your custom parameter set id parameter to the framework:
<div class="source">
<pre>PmParameterManager.setParameter(PmFrameworkPa.PARAM_SET_ID,
    PmParameterManager.getParameter(BasicPa.PARAM_SET_ID));
</pre></div></li>
<li>The 3rd variant is based on the 2nd and applies to Repast Simphony models only, and is the preferred way to organise batch runs: Create an <tt>.xml</tt> file that contains <tt>PARAM_SET_ID</tt> as parameter that varies from one batch run to another (all other parameters are defined within the ParMa framework):
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;sweep runs=&quot;0&quot;&gt;
        &lt;parameter name=&quot;PARAM_SET_ID&quot; type=&quot;number&quot; start=&quot;1&quot; end=&quot;10&quot; step=&quot;1&quot;/&gt;
&lt;/sweep&gt;
</pre></div>
<p>Then, read the RS parameter <tt>PARAM_SET_ID</tt> and assign it to the ParMa framework's <tt>PARAM_SET_ID</tt>:</p>
<div class="source">
<pre>if (RunEnvironment.getInstance().getParameters().getSchema()
                .contains(&quot;PARAM_SET_ID&quot;)) {
        PmParameterManager.setParameter(BasicPa.PARAM_SET_ID,
                        ((Integer) RunEnvironment.getInstance().getParameters()
                                        .getValue(&quot;PARAM_SET_ID&quot;)).intValue());
}
</pre></div></li></ol>
<p>Column names for parameters require the form <i>package</i>.<i>Enumeration</i>:<i>PARAMETER_NAME</i> (only exceptions are 'id' and 'description' - all others raise a warning). Note that you need to specify quotes around these constructs in SQL. The param set id refers to the column named &quot;id&quot; within the table.</p>
<p>Sometimes it is necessary to by-pass parameter reading from database, e.g. when a database is not available but the reader is configured in the source code. By-passing is enabled by setting <tt>&lt;SQL_TBLNAME_PARAMS</tt> to &quot;NOT DEFINED&quot;:</p>
<div class="source">
<pre>&lt;SQL_TBLNAME_PARAMS&gt;NOT DEFINED&lt;/SQL_TBLNAME_PARAMS&gt;
</pre></div></div>
<div class="section">
<h4>PmXmlParameterReader<a name="PmXmlParameterReader"></a></h4>
<p><tt>PmXmlParameterReader</tt> parses parameter data that is specified in an XML file. As in database tables, parameter names need to be given in the form <i>package</i>.<i>Enumeration</i>:<i>PARAMETER_NAME</i>. XML parameter files look like this:</p>
<div class="source">
<pre>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;parameters&gt;
&lt;de.cesr.parma.tests.BasicPa:NUM_AGENTS&gt;100&lt;/de.cesr.parma.tests.BasicPa:NUM_AGENTS&gt;
&lt;de.cesr.parma.tests.BasicPa:MUE&gt;0.1&lt;/de.cesr.parma.tests.BasicPa:MUE&gt;
&lt;/parameters&gt;
</pre></div>
<p>The <tt>PmXmlParameterReader</tt> is useful to provide default parameter values that are not hard-coded (initialise the reader at first) or to override parameter value, e.g. from database in order to test certain settings (initialise the reader at last). Note that you may invalidate the run information mechanism in the latter case!</p></div>
<div class="section">
<h4>PmDdXmlParameterReader<a name="PmDdXmlParameterReader"></a></h4>
<p>The <tt>PmDbXmlParameterReader</tt> is a special version of <tt>PmXmlParameterReader</tt> and reads in database settings specified in an XML-file whose name and location is defined in <tt>PmFrameworkPa#DB_SETTINGS_FILE</tt>. The <tt>PmDbXmlParameterReader</tt> is registered at the <tt>PmParameterManager</tt> by default.</p></div>
<div class="section">
<h4>PmGuiParameterReader<a name="PmGuiParameterReader"></a></h4>
<p>The <tt>PmGuiParameterReader</tt> currently is not ready for use.</p></div>
<div class="section">
<h4>Copying parameter values<a name="Copying_parameter_values"></a></h4>
<p>It is easy to copy a value from one parameter to another:</p>
<div class="source">
<pre>PmParameterManager.copyParameterValue(PmFrameworkPa.DBNAME, MSqlPa.DBNAME);
</pre></div>
<p>This is especially useful to copy a parameter defined in the user model to one or more libraries. Note: It is important to do the copy invocation after any assignment to the parameter that is copied. Otherwise, the new value of the source parameter does not effect the target parameter of the copying process! </p></div></div>
<div class="section">
<h3>Special Applications<a name="Special_Applications"></a></h3>
<div class="section">
<h4>Specific and/or Multiple Instances of <tt>PmParameterManager</tt><a name="Specific_andor_Multiple_Instances_of_PmParameterManager"></a></h4>
<p>In case there are several instances of a model part that shall all use the same parameter definitions but with different values assigned you need to create several instances of <a href="./javadoc/de/cesr/parma/core/PmParameterManager.html"><tt>PmParameterManager</tt></a>:</p>
<div class="source">
<pre>PmParameterManager.getNewInstance()
</pre></div>
<p>It is also possible to pass an identifier. This way, the instance is stored and can be obtained with the help of the identifier. This is useful e.g. when you need a specific instance for each region of a spatial simulation. You might want to use the region object as identifier:</p>
<div class="source">
<pre>PmParameterManager pm = PmParameterManager.getNewInstance(region);
PmParameterManager.getInstance(region).setParam(paramDefinition, value);
PmParameterManager.getInstance(region).getParam(paramDefinition);
</pre></div>
<p>Note that instance methods use the abbreviation &quot;Param&quot;: <tt>setParam(paramDefinition, value)</tt> and <tt>getParam(paramDefinition)</tt>. Using <tt>pm.getParameter(paramDefinition)</tt> results in accessing a different instance (required for backward compatibility)!</p>
<p>Furthermore, it is possible to use a static method and pass the identifier object to set the parameter at a specific instance of <tt>PmParameterManager</tt>:</p>
<div class="source">
<pre>PmParameterManager.setParameter(region, paramDefinition, value);
PmParameterManager.getParameter(region, paramDefinition);
</pre></div>
<div class="section">
<h5>Definition of Default PM instance for PM instances<a name="Definition_of_Default_PM_instance_for_PM_instances"></a></h5>
<p>Often specific parameter values are only required for a limited set of parameters while others shall be defined globally. For this case, a default instance of <a href="./javadoc/de/cesr/parma/core/PmParameterManager.html"><tt>PmParameterManager</tt></a> can be defined for each parameter manager instance. As a consequence, ParMa uses parameter values assigned in the default instance if a value for the particular parameter is not assigned in the current instance. See <a href="#Resolving_Parameter_Values">Resolving Parameter Values</a> for more information.</p></div></div>
<div class="section">
<h4>Use more than one Database Source<a name="Use_more_than_one_Database_Source"></a></h4>
<p>In case more than one database sources (also true when more than one tables in the same database shall be accessed) shall be used, one needs to initialise parameters in several steps:</p>
<div class="source">
<pre>PmParameterManager.setParameter(PmFrameworkPa.XML_PARAMETER_FILE,
        PmParameterManager.getParameter(BasicPa.XML_PARAMETER_FILE));
PmParameterManager.setParameter(PmFrameworkPa.DB_SETTINGS_FILE,
        &quot;./config/DBSettings.xml&quot;);
   
PmParameterManager.setParameter(PmFrameworkPa.PARAM_SET_ID,
        PmParameterManager.getParameter(BasicPa.PARAM_SET_ID));
   
PmParameterManager.registerReader(new PmDbXmlParameterReader());
PmParameterManager.registerReader(new PmDbParameterReader(BasicPa.PARAM_SET_ID));
PmParameterManager.registerReader(new MilieuPrefDataReader());
   
PmParameterManager.init();
   
PmParameterManager.setParameter(PmFrameworkPa.DB_SETTINGS_FILE,
        &quot;./config/DBSettingsSocNet.xml&quot;);
   
new PmDbXmlParameterReader().initParameters();
new PmDbParameterReader(SocNetPa.SOCNET_PARAM_ID).initParameters();
   
new PmXmlParameterReader().initParameters();
</pre></div>
<p>First, XML file locations for a <tt>PmXmlParameterReader</tt> and <tt>PmDbXmlParameterReader</tt> are passed from custom parameter definitions (<tt>PmFrameworkPa.XML_PARAMETER_FILE</tt>) or hard coded <tt>PmFrameworkPa.DB_SETTINGS_FILE</tt> to the ParMa framework definitions. </p>
<p>Furthermore, the param set id is copied from custom parameter definition. Note, for Repast Simphony batch runs you need to ensure that the parameter set id from the RS parameter scheme are passed to ParMa before any <tt>PmDbParameterReader</tt> are initialised! Afterwards, may not override the RS settings by copying custom definitions!</p>
<p>Then, number of readers including the <tt>PmDbXmlParameterReader</tt> and the first <tt>PmDbParameterReader</tt> are registered at the <tt>PmParameterManager</tt> and are initialised afterwards in the given order.</p>
<p>Afterwards, another XML file is set as <tt>DB_SETTINGS_FILE</tt> to read parameters from another table. Then, <tt>PmDbXmlParameterReader</tt> is initialised directly (thus, there is no need to register readers at <tt>PmParameterManager</tt>), and the second <tt>PmDbParameterReader</tt> is initialised directly as well.</p>
<p>At last, the <tt>PmFrameworkPa.DB_SETTINGS_FILE</tt> is initialised with the XML file specified at the beginning in order to possible override certain parameters. </p></div></div>
<div class="section">
<h3>Known Problems<a name="Known_Problems"></a></h3>
<div class="section">
<h4>Parallel Computing<a name="Parallel_Computing"></a></h4>
<p>For instance, if you want to instantiate in parallel several objects of a class with different parameter values using ParMa this requires special consideration: You need to initialise and use a specific instance of <a href="./javadoc/de/cesr/parma/core/PmParameterManager.html"><tt>PmParameterManager</tt></a> for each independent model part to prevent side effects.</p></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2014
                        <a href="www.cesr.de">Center for Environmental Systems Research (CESR), Universität Kassel</a>.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
